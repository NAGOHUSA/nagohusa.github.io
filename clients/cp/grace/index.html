<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Grace People Directory</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 0;
            margin: 0;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            -webkit-overflow-scrolling: touch;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
        }
        
        /* iPhone X/XS/11 Pro notch area handling */
        @supports(padding: max(0px)) {
            .container {
                padding-left: max(15px, env(safe-area-inset-left));
                padding-right: max(15px, env(safe-area-inset-right));
                padding-top: max(15px, env(safe-area-inset-top));
                padding-bottom: max(15px, env(safe-area-inset-bottom));
            }
        }
        
        header {
            text-align: center;
            padding: 20px 15px 15px;
            background: linear-gradient(135deg, #3498db 0%, #2c3e50 100%);
            color: white;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: white;
            margin-bottom: 8px;
            font-size: 1.8rem;
            font-weight: 700;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }
        
        .subtitle {
            color: rgba(255,255,255,0.9);
            font-size: 0.95rem;
            font-weight: 400;
        }
        
        .dashboard {
            display: flex;
            flex-direction: column;
            gap: 0;
        }
        
        .panel {
            background-color: white;
            padding: 20px 15px;
            margin-bottom: 0;
        }
        
        .search-panel {
            border-bottom: 1px solid #e1e5eb;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            position: sticky;
            top: 120px;
            z-index: 90;
        }
        
        .results-panel {
            padding-top: 15px;
        }
        
        .search-panel h2, .results-panel h2 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .search-box {
            display: flex;
            margin-bottom: 15px;
            width: 100%;
        }
        
        .search-input {
            flex-grow: 1;
            padding: 14px 15px;
            border: 1px solid #ddd;
            border-radius: 12px 0 0 12px;
            font-size: 16px; /* Prevents iOS zoom on focus */
            transition: border 0.3s;
            background-color: #f8f9fa;
            -webkit-appearance: none;
            appearance: none;
        }
        
        /* Fix for iOS input styling */
        .search-input:focus {
            outline: none;
            border-color: #3498db;
            background-color: white;
        }
        
        .search-btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 14px 18px;
            border-radius: 0 12px 12px 0;
            cursor: pointer;
            transition: background-color 0.3s;
            font-size: 1rem;
            min-width: 60px;
            -webkit-appearance: none;
            appearance: none;
        }
        
        .search-btn:active {
            background-color: #2980b9;
            transform: scale(0.98);
        }
        
        .search-options {
            margin-bottom: 15px;
        }
        
        .search-options h3 {
            font-size: 0.95rem;
            margin-bottom: 10px;
            color: #555;
            font-weight: 600;
        }
        
        .option-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .option-tag {
            background-color: #ecf0f1;
            border-radius: 20px;
            padding: 8px 14px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
            -webkit-user-select: none;
            user-select: none;
        }
        
        .option-tag:active {
            background-color: #d5dbdb;
            transform: scale(0.96);
        }
        
        .option-tag.active {
            background-color: #3498db;
            color: white;
        }
        
        .search-tips {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 12px;
            margin-top: 15px;
            border-left: 4px solid #3498db;
        }
        
        .search-tips p {
            font-size: 0.85rem;
            color: #666;
            line-height: 1.5;
        }
        
        .results-count {
            margin-bottom: 15px;
            color: #7f8c8d;
            font-size: 0.9rem;
            font-weight: 500;
            padding: 0 5px;
        }
        
        .results-table {
            width: 100%;
            border-collapse: collapse;
            overflow-x: auto;
            display: block;
            -webkit-overflow-scrolling: touch;
        }
        
        .results-table thead {
            background-color: #f8f9fa;
            position: sticky;
            top: 200px;
            z-index: 80;
        }
        
        .results-table th {
            text-align: left;
            padding: 12px 10px;
            font-weight: 600;
            color: #2c3e50;
            border-bottom: 2px solid #e1e5eb;
            font-size: 0.9rem;
            white-space: nowrap;
        }
        
        .results-table td {
            padding: 15px 10px;
            border-bottom: 1px solid #f0f0f0;
            vertical-align: top;
            font-size: 0.95rem;
        }
        
        .results-table tr:active {
            background-color: #f9f9f9;
        }
        
        .no-results {
            text-align: center;
            padding: 50px 20px;
            color: #7f8c8d;
            font-size: 1rem;
        }
        
        .no-results i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: #bdc3c7;
        }
        
        .person-name {
            font-weight: 600;
            color: #2c3e50;
            font-size: 1rem;
            margin-bottom: 4px;
        }
        
        .person-contact {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .person-email, .person-phone {
            font-size: 0.85rem;
            color: #555;
            word-break: break-all;
        }
        
        .person-email i, .person-phone i {
            margin-right: 8px;
            color: #3498db;
            min-width: 16px;
        }
        
        .person-address {
            font-size: 0.85rem;
            color: #777;
            line-height: 1.4;
        }
        
        .loading {
            text-align: center;
            padding: 60px 20px;
            color: #7f8c8d;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        footer {
            text-align: center;
            padding: 20px 15px;
            color: #95a5a6;
            font-size: 0.85rem;
            background-color: #f8f9fa;
            border-top: 1px solid #ecf0f1;
        }
        
        /* iPhone-specific optimizations */
        @media screen and (max-width: 768px) {
            .results-table {
                display: block;
                width: 100%;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            .results-table th,
            .results-table td {
                padding: 12px 8px;
                font-size: 0.9rem;
            }
            
            .person-name {
                font-size: 0.95rem;
            }
            
            .person-email, .person-phone, .person-address {
                font-size: 0.82rem;
            }
        }
        
        /* iPhone 5/SE and smaller */
        @media screen and (max-width: 320px) {
            h1 {
                font-size: 1.5rem;
            }
            
            .subtitle {
                font-size: 0.85rem;
            }
            
            .search-input, .search-btn {
                padding: 12px 10px;
            }
            
            .option-tag {
                padding: 6px 10px;
                font-size: 0.8rem;
            }
            
            .results-table th,
            .results-table td {
                padding: 10px 6px;
                font-size: 0.85rem;
            }
        }
        
        /* iPhone landscape optimization */
        @media screen and (max-height: 500px) and (orientation: landscape) {
            header {
                padding: 10px 15px;
            }
            
            h1 {
                font-size: 1.5rem;
                margin-bottom: 5px;
            }
            
            .search-panel {
                position: relative;
                top: 0;
            }
            
            .results-table thead {
                position: relative;
                top: 0;
            }
        }
        
        /* Dark mode support for iOS */
        @media (prefers-color-scheme: dark) {
            body {
                background-color: #121212;
                color: #e0e0e0;
            }
            
            .panel, .search-tips, footer {
                background-color: #1e1e1e;
                color: #e0e0e0;
            }
            
            header {
                background: linear-gradient(135deg, #1a5276 0%, #1c2833 100%);
            }
            
            .search-input {
                background-color: #2c2c2c;
                border-color: #444;
                color: #e0e0e0;
            }
            
            .search-input:focus {
                background-color: #333;
                border-color: #3498db;
            }
            
            .search-tips {
                background-color: #252525;
                border-left-color: #3498db;
            }
            
            .results-table thead {
                background-color: #252525;
            }
            
            .results-table th {
                color: #e0e0e0;
                border-bottom-color: #444;
            }
            
            .results-table td {
                border-bottom-color: #333;
            }
            
            .person-name {
                color: #e0e0e0;
            }
            
            .person-email, .person-phone, .person-address {
                color: #b0b0b0;
            }
            
            .option-tag {
                background-color: #333;
                color: #e0e0e0;
            }
            
            .option-tag.active {
                background-color: #3498db;
            }
            
            .no-results i, .loading {
                color: #666;
            }
        }
        
        /* iOS Safari specific fixes */
        @supports (-webkit-touch-callout: none) {
            .search-input, .search-btn {
                height: 48px; /* Better touch target for iOS */
            }
            
            .option-tag {
                padding: 10px 14px; /* Larger touch target */
            }
            
            .results-table tr {
                min-height: 44px; /* Apple's recommended minimum touch target */
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-address-book"></i> Grace Directory</h1>
            <p class="subtitle">Search and connect with community members</p>
        </header>
        
        <div class="dashboard">
            <div class="panel search-panel">
                <h2><i class="fas fa-search"></i> Search</h2>
                
                <div class="search-box">
                    <input type="search" id="searchInput" class="search-input" placeholder="Search name, email, city..." autocapitalize="none" autocomplete="off">
                    <button id="searchBtn" class="search-btn">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
                
                <div class="search-options">
                    <h3>Quick Search</h3>
                    <div class="option-tags">
                        <div class="option-tag" data-search="New York">NYC</div>
                        <div class="option-tag" data-search="Los Angeles">LA</div>
                        <div class="option-tag" data-search="Chicago">Chicago</div>
                        <div class="option-tag" data-search="202-">DC Area</div>
                        <div class="option-tag" data-search="CA">California</div>
                    </div>
                </div>
                
                <div class="search-tips">
                    <p><i class="fas fa-lightbulb"></i> <strong>Tip:</strong> You can search by first name, last name, email, phone, city, or state.</p>
                </div>
            </div>
            
            <div class="panel results-panel">
                <h2><i class="fas fa-users"></i> Results</h2>
                <div class="results-count" id="resultsCount">Loading directory...</div>
                
                <div id="resultsContainer">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Loading directory data...</p>
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Grace People Directory &copy; <span id="currentYear"></span> | <span id="resultCountFooter">Loading...</span></p>
        </footer>
    </div>

    <script>
        // Set current year in footer
        document.getElementById('currentYear').textContent = new Date().getFullYear();
        
        // Sample CSV data (in a real scenario, this would be loaded from a file)
        const csvData = `first_name,last_name,email,phone,street,street_2,city,state,postal_code
John,Smith,john.smith@example.com,202-555-0101,123 Main St,Apt 4B,New York,NY,10001
Emma,Johnson,emma.johnson@example.com,310-555-0102,456 Oak Ave,,Los Angeles,CA,90001
Michael,Brown,michael.brown@example.com,415-555-0103,789 Pine Rd,Suite 200,San Francisco,CA,94102
Sarah,Davis,sarah.davis@example.com,202-555-0104,321 Elm St,,Washington,DC,20001
James,Wilson,james.wilson@example.com,312-555-0105,654 Maple Dr,Unit 12,Chicago,IL,60601
Patricia,Moore,patricia.moore@example.com,713-555-0106,987 Birch Ln,,Houston,TX,77001
Robert,Taylor,robert.taylor@example.com,305-555-0107,147 Cedar Blvd,Apt 5C,Miami,FL,33101
Jennifer,Anderson,jennifer.anderson@example.com,617-555-0108,258 Spruce Ct,,Boston,MA,02101
David,Thomas,david.thomas@example.com,702-555-0109,369 Willow Way,,Las Vegas,NV,89101
Linda,Jackson,linda.jackson@example.com,214-555-0110,741 Aspen St,Floor 3,Dallas,TX,75201
William,White,william.white@example.com,404-555-0111,852 Redwood Ave,,Atlanta,GA,30301
Elizabeth,Harris,elizabeth.harris@example.com,503-555-0112,963 Fir Pl,,Portland,OR,97201
Christopher,Martin,christopher.martin@example.com,602-555-0113,159 Magnolia Dr,,Phoenix,AZ,85001
Susan,Thompson,susan.thompson@example.com,202-555-0114,753 Sycamore Rd,,Baltimore,MD,21201
Joseph,Garcia,joseph.garcia@example.com,619-555-0115,357 Palm St,Apt 7B,San Diego,CA,92101
Margaret,Martinez,margaret.martinez@example.com,212-555-0116,852 Olive Ave,,New York,NY,10002
Charles,Robinson,charles.robinson@example.com,310-555-0117,456 Juniper Ln,,Los Angeles,CA,90002
Jessica,Clark,jessica.clark@example.com,415-555-0118,789 Cypress Dr,Suite 100,San Francisco,CA,94103
Thomas,Rodriguez,thomas.rodriguez@example.com,202-555-0119,321 Poplar St,,Washington,DC,20002
Karen,Lewis,karen.lewis@example.com,312-555-0120,654 Sequoia Rd,Unit 8,Chicago,IL,60602`;
        
        // Parse CSV data into array of objects
        function parseCSV(csv) {
            const lines = csv.split('\n');
            const headers = lines[0].split(',');
            
            const result = [];
            for (let i = 1; i < lines.length; i++) {
                if (lines[i].trim() === '') continue;
                
                const obj = {};
                const currentLine = lines[i].split(',');
                
                for (let j = 0; j < headers.length; j++) {
                    obj[headers[j].trim()] = currentLine[j] ? currentLine[j].trim() : '';
                }
                
                result.push(obj);
            }
            
            return result;
        }
        
        // Load and display directory data
        let directoryData = [];
        
        function loadDirectoryData() {
            directoryData = parseCSV(csvData);
            displayResults(directoryData);
            document.getElementById('resultCountFooter').textContent = `${directoryData.length} contacts`;
        }
        
        // Display results in the table
        function displayResults(data) {
            const resultsContainer = document.getElementById('resultsContainer');
            const resultsCount = document.getElementById('resultsCount');
            const footerCount = document.getElementById('resultCountFooter');
            
            if (data.length === 0) {
                resultsContainer.innerHTML = `
                    <div class="no-results">
                        <i class="fas fa-user-slash"></i>
                        <h3>No Results Found</h3>
                        <p>Try different search terms</p>
                    </div>
                `;
                resultsCount.textContent = `0 contacts found`;
                footerCount.textContent = `0 contacts`;
                return;
            }
            
            // Create table structure
            let tableHTML = `
                <div style="overflow-x:auto; -webkit-overflow-scrolling: touch;">
                    <table class="results-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Contact</th>
                                <th>Location</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            // Add rows for each person
            data.forEach(person => {
                const addressLine2 = person.street_2 ? `<br>${person.street_2}` : '';
                const fullAddress = `${person.street}${addressLine2}<br>${person.city}, ${person.state}`;
                
                tableHTML += `
                    <tr>
                        <td>
                            <div class="person-name">${person.first_name} ${person.last_name}</div>
                        </td>
                        <td>
                            <div class="person-contact">
                                <div class="person-email"><i class="fas fa-envelope"></i> ${person.email}</div>
                                <div class="person-phone"><i class="fas fa-phone"></i> ${person.phone}</div>
                            </div>
                        </td>
                        <td>
                            <div class="person-address">${fullAddress}</div>
                        </td>
                    </tr>
                `;
            });
            
            tableHTML += `
                        </tbody>
                    </table>
                </div>
            `;
            
            resultsContainer.innerHTML = tableHTML;
            resultsCount.textContent = `${data.length} ${data.length === 1 ? 'contact' : 'contacts'} found`;
            footerCount.textContent = `${data.length} contacts`;
            
            // Add touch event listeners to table rows for better iOS interaction
            document.querySelectorAll('.results-table tr').forEach(row => {
                row.addEventListener('touchstart', function() {
                    this.style.backgroundColor = '#f5f5f5';
                });
                
                row.addEventListener('touchend', function() {
                    this.style.backgroundColor = '';
                });
            });
        }
        
        // Search directory data
        function searchDirectory(query) {
            if (!query.trim()) {
                return directoryData;
            }
            
            const searchTerms = query.toLowerCase().split(' ').filter(term => term);
            
            return directoryData.filter(person => {
                // Combine all person data into a single string for searching
                const searchableText = `
                    ${person.first_name} ${person.last_name} 
                    ${person.email} ${person.phone} 
                    ${person.street} ${person.street_2} 
                    ${person.city} ${person.state} ${person.postal_code}
                `.toLowerCase();
                
                // Check if all search terms are found in the searchable text
                return searchTerms.every(term => searchableText.includes(term));
            });
        }
        
        // Handle search button click
        document.getElementById('searchBtn').addEventListener('click', () => {
            const query = document.getElementById('searchInput').value;
            const results = searchDirectory(query);
            displayResults(results);
            // Hide iOS keyboard after search
            document.getElementById('searchInput').blur();
        });
        
        // Handle Enter key in search input
        document.getElementById('searchInput').addEventListener('keyup', (event) => {
            if (event.key === 'Enter') {
                const query = document.getElementById('searchInput').value;
                const results = searchDirectory(query);
                displayResults(results);
                // Hide iOS keyboard after search
                document.getElementById('searchInput').blur();
            }
        });
        
        // Handle quick search option tags with touch feedback
        document.querySelectorAll('.option-tag').forEach(tag => {
            tag.addEventListener('click', () => {
                // Remove active class from all tags
                document.querySelectorAll('.option-tag').forEach(t => {
                    t.classList.remove('active');
                });
                
                // Add active class to clicked tag
                tag.classList.add('active');
                
                // Set search input value and trigger search
                const searchValue = tag.getAttribute('data-search');
                document.getElementById('searchInput').value = searchValue;
                
                const results = searchDirectory(searchValue);
                displayResults(results);
            });
            
            // Add touch feedback for iOS
            tag.addEventListener('touchstart', function() {
                this.style.transform = 'scale(0.95)';
            });
            
            tag.addEventListener('touchend', function() {
                this.style.transform = '';
            });
        });
        
        // Initialize the directory when page loads
        document.addEventListener('DOMContentLoaded', () => {
            // Add a slight delay to show loading state (better UX)
            setTimeout(() => {
                loadDirectoryData();
            }, 500);
            
            // Fix for iOS viewport height issue
            function setVH() {
                let vh = window.innerHeight * 0.01;
                document.documentElement.style.setProperty('--vh', `${vh}px`);
            }
            
            setVH();
            window.addEventListener('resize', setVH);
            window.addEventListener('orientationchange', setVH);
            
            // Prevent iOS zoom on input focus
            document.getElementById('searchInput').addEventListener('touchstart', function(e) {
                this.style.fontSize = '16px'; // Prevents zoom on focus
            });
            
            // Handle iOS back button in search
            document.getElementById('searchInput').addEventListener('search', function() {
                if (this.value === '') {
                    displayResults(directoryData);
                }
            });
        });
        
        // Handle page visibility for iOS (when switching apps)
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden) {
                // Page is visible again, refresh if needed
                displayResults(directoryData);
            }
        });
    </script>
</body>
</html>
